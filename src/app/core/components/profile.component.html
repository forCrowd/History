<div class="m-16">
  <h1>Dashboard</h1>
  <h2>History timelines</h2>
</div>

<div class="m-16">
  <form #historyForm="ngForm" autocomplete="off">
    <mat-form-field>
      <input matInput id="entry" name="entry" type="text" placeholder="Write new timeline name"
      [(ngModel)]="entry" class="form-control" required />
    </mat-form-field>
    <button mat-flat-button (click)="createNewHistroyTimeline()" [disabled]="historyForm.form.invalid || isBusy">
      New Timeline
    </button>
    <button mat-flat-button *ngIf="entry === ''" (click)="cancelEditing()"
      color="warn" [disabled]="historyForm.form.invalid || isBusy">
      Cancel
    </button>
  </form>
</div>
<div class="m-16">
  <mat-divider></mat-divider>

  <div *ngIf="currentUser === profileUser">
    <button mat-button [disabled]="isBusy || selection.selected.length === 0" (click)="deleteSelectedTimeline()" [hidden]="dataSource.data.length === 0">
      <i class="material-icons">delete</i>
      Delete
    </button>
  </div>

  <mat-card [hidden]="dataSource.data.length > 0">
    <div class="noResults">
      Nothing to display!
    </div>
  </mat-card>

  <mat-card class="g-mb-150" [hidden]="dataSource.data.length === 0">
    <table mat-table [dataSource]="dataSource" [trackBy]="trackBy" [hidden]="dataSource.data.length === 0">
      <!-- Checkbox Column -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox (change)="$event ? masterToggle() : null"
                        [checked]="selection.hasValue() && isAllSelected()"
                        [indeterminate]="selection.hasValue() && !isAllSelected()">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let element">
          <mat-checkbox (click)="$event.stopPropagation()"
                        (change)="$event ? selection.toggle(element) : null"
                        [checked]="selection.isSelected(element)">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> History </th>
        <td mat-cell *matCellDef="let element">
          <a *ngIf="currentUser === profileUser" routerLink="/history/{{ element.Name }}"> {{ element.Name }} </a>
          <a *ngIf="currentUser !== profileUser"> {{ element.Name }} </a>
        </td>
      </ng-container>

      <!-- Count -->
      <ng-container matColumnDef="items">
        <th mat-header-cell *matHeaderCellDef> # Items </th>
        <td mat-cell *matCellDef="let element"> {{ element.ElementItemSet.length / 2 }} </td>
      </ng-container>

      <!-- CreatedOn -->
      <ng-container matColumnDef="createdOn">
        <th mat-header-cell *matHeaderCellDef> Created On</th>
        <td mat-cell *matCellDef="let element"> {{ element.CreatedOn | amTimeAgo }} </td>
      </ng-container>

      <!-- Functions -->
      <ng-container matColumnDef="functions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element">
          <div class="pull-right">
            <button mat-button routerLink="/users/{{currentUser.UserName}}/{{ element.Name }}" [disabled]="isBusy" class="mat-m02">
              <i class="fa fa-eye" aria-hidden="true"></i> View
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)"></tr>
    </table>
  </mat-card>

</div>

